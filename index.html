<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Plan de Lecture Biblique et Mes Neuvaines</title>
    <!-- Chargement de Tailwind CSS pour un style moderne et réactif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chargement des polices Merriweather (pour le corps) et Inter (pour l'interface) -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles de base pour le corps de la page avec la police Merriweather */
        body {
            font-family: 'Merriweather', serif;
            background-color: #f3f4f6;
        }
        /* Styles personnalisés pour la barre de défilement */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0a0a0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #808080;
        }
        /* Appliquer la police Inter aux boutons spécifiquement pour une meilleure lisibilité UI */
        button {
            font-family: 'Inter', sans-serif;
        }
        .neuvaine-card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            max-width: 900px;
            margin: 2rem auto;
            position: relative;
        }
        .image-container {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #fcd34d;
        }
        .image-container img {
            object-fit: cover;
            width: 100%;
            height: 100%;
        }
        #bougie {
            cursor: pointer;
            width: 100px;
            height: auto;
            transition: filter 0.3s ease-in-out;
        }
        .bougie-lit {
            filter: drop-shadow(0 0 10px gold);
        }
        .demande-container textarea {
            min-height: 120px;
        }
        .prieur-block {
            background-color: #f9fafb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        .prieur-block h2 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        .bouton-principal {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .bouton-principal:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 bg-gradient-to-br from-blue-100 to-indigo-200">
    <!-- Section Plan de Lecture Biblique -->
    <div id="bible-plan-section" class="bg-white rounded-xl shadow-xl p-6 sm:p-8 md:p-10 max-w-2xl w-full flex flex-col items-center mb-6">
        <h1 class="text-3xl sm:text-4xl font-bold text-indigo-900 mb-6 text-center">Mon Plan de Lecture Biblique</h1>
        <div class="w-full text-center">
            <p class="text-lg sm:text-xl text-blue-700 mb-4" id="current-day-text">Chargement...</p>
            <p class="text-xl italic text-blue-900 mb-6" id="current-reading-text">Chargement...</p>
        </div>
        <!-- Boutons de navigation pour le plan biblique -->
        <div class="flex flex-col sm:flex-row gap-4 w-full justify-center mb-6">
            <button id="prev-day-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 flex items-center justify-center">
                Jour Précédent <span id="prev-date" class="ml-2 text-sm opacity-80"></span>
            </button>
            <button id="next-day-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 flex items-center justify-center">
                Jour Suivant <span id="next-date" class="ml-2 text-sm opacity-80"></span>
            </button>
        </div>
        <!-- Bouton pour ouvrir la lecture externe -->
        <button id="open-reading-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-opacity-75 w-full sm:w-auto mb-6">
            Lire le Texte sur BibleGateway
        </button>
    </div>
    <!-- Section pour le texte biblique (expliquant la limitation CORS) -->
    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 text-center text-blue-700 w-full max-w-2xl mb-6">
        <p class="text-xs">
            Pour des raisons de sécurité du navigateur (CORS), le texte biblique ne peut pas être affiché directement ici.
            Cliquez sur le bouton ci-dessus pour ouvrir le passage sur BibleGateway.com dans un nouvel onglet.
        </p>
    </div>

    <!-- Section Neuvaines -->
    <div id="novenas-standalone-section" class="neuvaine-card mb-6">
        <header class="text-center mb-8">
            <h2 id="novena-main-title" class="text-3xl sm:text-4xl font-extrabold text-gray-900">Mes Neuvaines</h2>
        </header>
        <!-- Conteneur pour la photo et la bougie -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
            <div class="image-container">
                <input type="file" id="photoUpload" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer">
                <img id="neuvaine-photo" src="https://placehold.co/150x150/e5e7eb/4b5563?text=Ajouter+une+photo" alt="Votre photo de neuvaine" class="w-full h-full object-cover">
            </div>
            <div class="image-container flex items-center justify-center border-none">
                <img id="bougie" src="https://storage.googleapis.com/gweb-uniblog-publish-prod/images/candle-unlit.png" alt="Une bougie" class="bougie-unlit">
            </div>
        </div>
        
        <!-- Sélecteur de Neuvaine et Date de Début -->
        <div class="flex flex-col sm:flex-row gap-4 mb-6 w-full justify-center">
            <div class="w-full sm:w-auto">
                <label for="novena-select" class="block text-lg text-gray-700 font-semibold mb-1">Choisir une Neuvaine:</label>
                <select id="novena-select" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-400 w-full"></select>
            </div>
            <div class="w-full sm:w-auto">
                <label for="novena-start-date" class="block text-lg text-gray-700 font-semibold mb-1">Date de Début:</label>
                <input type="date" id="novena-start-date" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-400 w-full" disabled>
            </div>
        </div>

        <!-- Section de la demande du jour -->
        <div class="demande-container bg-blue-50 border-l-4 border-blue-400 p-6 rounded-lg mb-8">
            <label for="demandeDuJour" class="block text-lg font-medium text-blue-800 mb-2">Formulez votre demande du jour :</label>
            <textarea id="demandeDuJour" placeholder="Votre demande..." class="w-full p-3 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></textarea>
            <button id="saveDemande" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">Sauvegarder ma demande</button>
        </div>

        <!-- Prières initiales (Confiteor et Saint-Michel) -->
        <div class="prieres-container" id="initial-prayers">
            <div class="prieur-block">
                <h2>Confiteor</h2>
                <p>Je confesse à Dieu tout-puissant, je reconnais devant mes frères, que j’ai péché en pensée, en parole, par action et par omission; oui, j’ai vraiment péché. C’est pourquoi je supplie la Vierge Marie, les anges et tous les saints, et vous aussi, mes frères, de prier pour moi le Seigneur notre Dieu. Que Dieu tout-puissant nous fasse miséricorde; qu’il nous pardonne nos péchés et nous conduise à la vie éternelle. Amen.</p>
            </div>
            <div class="prieur-block">
                <h2>Prière à saint Michel</h2>
                <p>“Saint Michel Archange, rempli de la sagesse de Dieu, fort dans le combat, viens à mon aide, soutiens-moi dans les difficultés, les épreuves, quand je souffre, quand je doute, quand je pleure. Obtiens-moi le courage, la force, la volonté, pour ne pas me laisser abattre. Saint Michel Archange, sois mon défenseur et protecteur contre les forces du Mal. Me confiant en l’intercession de votre Bienheureux Archange Saint Michel, je vous supplie, Seigneur Père, Fils et Saint-Esprit, de m’accorder la grâce… <span class="demande-placeholder">(formuler votre demande)</span>”</p>
            </div>
        </div>
        
        <!-- Conteneur pour la prière quotidienne -->
        <div class="prieur-block">
            <h2 id="daily-prayer-title">Prière Quotidienne</h2>
            <p id="daily-prayer-text">Veuillez sélectionner une neuvaine et une date pour voir la prière ici.</p>
        </div>

        <!-- Boutons de navigation pour les neuvaines -->
        <div class="flex flex-col sm:flex-row gap-4 mt-8 justify-center">
            <button id="prev-novena-day-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75" disabled>
                Jour Précédent
            </button>
            <button id="next-novena-day-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75" disabled>
                Jour Suivant
            </button>
        </div>
    </div>

    <!-- Boîte de message temporaire (pour les notifications comme "copié!") -->
    <div id="message-box" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-xl hidden transition-opacity duration-300 ease-out opacity-0">
        Message
    </div>

    <script>
        // Le code JavaScript complet a été fusionné ici

        // ====================================================================================
        // DONNÉES ET ÉLÉMENTS DU DOM
        // ====================================================================================

        // Données des neuvaines
        const novenasDefinitions = [
            {
                id: "st_michel",
                name: "Neuvaine à Saint Michel Archange",
                days: [
                    { day: 1, title: "Jour 1: Prière pour la foi", text: "Ô Glorieux Prince des Milices Célestes, Saint Michel Archange, défendez-nous dans le combat contre les principautés et les puissances, contre les dominateurs de ce monde de ténèbres, contre les esprits de malice répandus dans les airs. Venez en aide aux hommes que Dieu a faits à son image et à sa ressemblance, et rachetés à si grand prix de la tyrannie du diable. Amen." },
                    { day: 2, title: "Jour 2: Prière pour l'espérance", text: "Saint Michel Archange, vous qui êtes le gardien de l'Église, protégez-la de toutes les attaques de l'ennemi. Inspirez-nous l'espérance en la victoire finale du Christ, et aidez-nous à rester fermes dans la foi. Amen." },
                    { day: 3, title: "Jour 3: Prière pour la charité", text: "Archange de la charité divine, Saint Michel, enflammez nos cœurs de l'amour de Dieu et du prochain. Apprenez-nous à servir avec humilité et dévouement, et à aimer comme le Christ nous a aimés. Amen." },
                    { day: 4, title: "Jour 4: Prière pour la pureté", text: "Purificateur des âmes, Saint Michel, obtenez-nous la grâce de la pureté du cœur et de l'esprit. Délivrez-nous de toute impureté et aidez-nous à vivre selon la volonté de Dieu. Amen." },
                    { day: 5, title: "Jour 5: Prière pour la persévérance", text: "Saint Michel, modèle de persévérance, fortifiez-nous dans les épreuves et les tentations. Aidez-nous à ne jamais nous décourager et à toujours chercher à faire la volonté de Dieu. Amen." },
                    { day: 6, title: "Jour 6: Prière pour la sagesse", text: "Archange de la sagesse divine, Saint Michel, éclairez notre intelligence et notre cœur. Accordez-nous la sagesse qui vient d'en haut pour discerner le bien et le mal. Amen." },
                    { day: 7, title: "Jour 7: Prière pour la protection", text: "Protecteur céleste, Saint Michel, veillez sur nous jour et nuit. Éloignez de nous tout danger, visible et invisible, et conduisez-nous sur le chemin du salut. Amen." },
                    { day: 8, title: "Jour 8: Prière pour la guérison", text: "Saint Michel, guérisseur des âmes et des corps, intercédez pour nous auprès du Seigneur. Obtenez-nous la guérison de nos maladies et la consolation dans nos souffrances. Amen." },
                    { day: 9, title: "Jour 9: Prière pour la paix", text: "Prince de la Paix, Saint Michel, établissez la paix dans nos cœurs, dans nos familles et dans le monde entier. Que votre présence nous apporte la sérénité et la joie. Amen." }
                ]
            },
            {
                id: "sainte_marie",
                name: "Neuvaine à la Sainte Vierge Marie",
                days: [
                    { day: 1, title: "Jour 1: Prière pour l'humilité", text: "Ô Marie, Mère de Dieu et notre Mère, vous qui avez été humble et obéissante, obtenez-nous la grâce de l'humilité afin que nous puissions servir Dieu avec un cœur pur. Amen." },
                    { day: 2, title: "Jour 2: Prière pour la pureté", text: "Vierge très pure, modèle de chasteté, aidez-nous à garder nos cœurs et nos corps purs, et à vivre dans la sainteté. Amen." },
                    { day: 3, title: "Jour 3: Prière pour la charité", text: "Mère de l'amour divin, Marie, enflammez nos cœurs de l'amour de Dieu et du prochain, afin que nous puissions aimer comme le Christ nous a aimés. Amen." },
                    { day: 4, title: "Jour 4: Prière pour la patience", text: "Ô Marie, vous qui avez supporté tant de souffrances avec patience, obtenez-nous la force de supporter nos épreuves avec résignation et confiance en Dieu. Amen." },
                    { day: 5, title: "Jour 5: Prière pour la foi", text: "Mère de la foi, Marie, fortifiez notre foi en Dieu et en ses promesses. Aidez-nous à croire sans douter, même dans les moments difficiles. Amen." },
                    { day: 6, title: "Jour 6: Prière pour l'espérance", text: "Mère de l'espérance, Marie, inspirez-nous une ferme espérance en la miséricorde de Dieu et en la vie éternelle. Amen." },
                    { day: 7, title: "Jour 7: Prière pour l'obéissance", text: "Vierge obéissante, vous qui avez toujours fait la volonté de Dieu, aidez-nous à être obéissants à la voix de Dieu et à l'enseignement de l'Église. Amen." },
                    { day: 8, title: "Jour 8: Prière pour la persévérance", text: "Mère de la persévérance, Marie, obtenez-nous la grâce de persévérer dans la prière et dans le bien jusqu'à la fin de nos jours. Amen." },
                    { day: 9, title: "Jour 9: Prière pour la paix", text: "Reine de la paix, Marie, priez pour nous et pour le monde entier afin que la paix du Christ règne dans les cœurs et dans les nations. Amen." }
                ]
            },
            {
                id: "st_joseph",
                name: "Neuvaine à Saint Joseph",
                days: [
                    { day: 1, title: "Jour 1: Saint Joseph, homme juste", text: "Ô Saint Joseph, homme juste et fidèle, modèle de toutes les vertus, nous vous prions de nous obtenir la grâce de vivre dans la justice et la sainteté, en conformité avec la volonté de Dieu. Amen." },
                    { day: 2, title: "Jour 2: Saint Joseph, père nourricier de Jésus", text: "Saint Joseph, vous qui avez veillé sur Jésus avec un amour paternel, protégez nos familles et aidez-nous à élever nos enfants dans la foi et l'amour de Dieu. Amen." },
                    { day: 3, title: "Jour 3: Saint Joseph, époux de la Vierge Marie", text: "Ô Saint Joseph, époux chaste et pur de la Vierge Marie, obtenez-nous la grâce de la pureté du cœur et de l'esprit, et de vivre dans la fidélité à nos engagements. Amen." },
                    { day: 4, title: "Jour 4: Saint Joseph, modèle des travailleurs", text: "Saint Joseph, travailleur humble et diligent, inspirez-nous l'amour du travail et la persévérance dans nos efforts. Aidez-nous à offrir notre travail à Dieu pour sa gloire. Amen." },
                    { day: 5, title: "Jour 5: Saint Joseph, protecteur de l'Église", text: "Ô Saint Joseph, protecteur de l'Église universelle, veillez sur elle et défendez-la contre toutes les attaques de l'ennemi. Priez pour nos pasteurs et pour tous les fidèles. Amen." },
                    { day: 6, title: "Jour 6: Saint Joseph, espoir des malades", text: "Saint Joseph, vous qui avez connu la souffrance, soyez l'espoir des malades et des affligés. Obtenez-leur la guérison et la consolation dans leurs épreuves. Amen." },
                    { day: 7, title: "Jour 7: Saint Joseph, patron de la bonne mort", text: "Ô Saint Joseph, patron de la bonne mort, assistez-nous à l'heure de notre mort et obtenez-nous la grâce d'une mort sainte et paisible. Amen." },
                    { day: 8, title: "Jour 8: Saint Joseph, terreur des démons", text: "Saint Joseph, terreur des démons, protégez-nous des pièges de l'ennemi et de toutes les tentations. Soyez notre bouclier dans le combat spirituel. Amen." },
                    { day: 9, title: "Jour 9: Saint Joseph, consolateur des affligés", text: "Ô Saint Joseph, consolateur des affligés, soyez notre refuge dans la détresse. Essuyez nos larmes et obtenez-nous la paix et la joie du Seigneur. Amen." }
                ]
            }
        ];
        // Données du plan de lecture biblique (texte brut)
        const rawBibleReadingPlan = `
        Jour 1 - Genèse 1, 2, 3
        Jour 2 - Genèse 4, 5, 6
        Jour 3 - Genèse 7, 8, 9
        Jour 4 - Genèse 10, 11, 12
        Jour 5 - Genèse 13, 14, 15
        Jour 6 - Genèse 16, 17, 18
        Jour 7 - Genèse 19, 20, 21
        Jour 8 - Genèse 22, 23, 24
        Jour 9 - Genèse 25, 26, 27
        Jour 10 - Genèse 28, 29, 30
        Jour 11 - Genèse 31, 32, 33
        Jour 12 - Genèse 34, 35, 36
        Jour 13 - Genèse 37, 38, 39
        Jour 14 - Genèse 40, 41, 42
        Jour 15 - Genèse 43, 44, 45
        Jour 16 - Genèse 46, 47, 48
        Jour 17 - Genèse 49, 50 ; Exode 1
        Jour 18 - Exode 2, 3, 4
        Jour 19 - Exode 5, 6, 7
        Jour 20 - Exode 8, 9, 10
        Jour 21 - Exode 11, 12, 13
        Jour 22 - Exode 14, 15, 16
        Jour 23 - Exode 17, 18, 19
        Jour 24 - Exode 20, 21, 22
        Jour 25 - Exode 23, 24, 25
        Jour 26 - Exode 26, 27, 28
        Jour 27 - Exode 29, 30, 31
        Jour 28 - Exode 32, 33, 34
        Jour 29 - Exode 35, 36, 37
        Jour 30 - Exode 38, 39, 40
        Jour 31 - Lévitique 1, 2, 3
        Jour 32 - Lévitique 4, 5, 6
        Jour 33 - Lévitique 7, 8, 9
        Jour 34 - Lévitique 10, 11, 12
        Jour 35 - Lévitique 13, 14, 15
        Jour 36 - Lévitique 16, 17, 18
        Jour 37 - Lévitique 19, 20, 21
        Jour 38 - Lévitique 22, 23, 24
        Jour 39 - Lévitique 25, 26, 27
        Jour 40 - Nombres 1, 2, 3
        Jour 41 - Nombres 4, 5, 6
        Jour 42 - Nombres 7, 8, 9
        Jour 43 - Nombres 10, 11, 12
        Jour 44 - Nombres 13, 14, 15
        Jour 45 - Nombres 16, 17, 18
        Jour 46 - Nombres 19, 20, 21
        Jour 47 - Nombres 22, 23, 24
        Jour 48 - Nombres 25, 26, 27
        Jour 49 - Nombres 28, 29, 30
        Jour 50 - Nombres 31, 32, 33
        Jour 51 - Nombres 34, 35, 36
        Jour 52 - Deutéronome 1, 2, 3
        Jour 53 - Deutéronome 4, 5, 6
        Jour 54 - Deutéronome 7, 8, 9
        Jour 55 - Deutéronome 10, 11, 12
        Jour 56 - Deutéronome 13, 14, 15
        Jour 57 - Deutéronome 16, 17, 18
        Jour 58 - Deutéronome 19, 20, 21
        Jour 59 - Deutéronome 22, 23, 24
        Jour 60 - Deutéronome 25, 26, 27
        Jour 61 - Deutéronome 28, 29, 30
        Jour 62 - Deutéronome 31, 32, 33
        Jour 63 - Deutéronome 34 ; Josué 1, 2
        Jour 64 - Josué 3, 4, 5
        Jour 65 - Josué 6, 7, 8
        Jour 66 - Josué 9, 10, 11
        Jour 67 - Josué 12, 13, 14
        Jour 68 - Josué 15, 16, 17
        Jour 69 - Josué 18, 19, 20
        Jour 70 - Josué 21, 22, 23
        Jour 71 - Josué 24 ; Juges 1, 2
        Jour 72 - Juges 3, 4, 5
        Jour 73 - Juges 6, 7, 8
        Jour 74 - Juges 9, 10, 11
        Jour 75 - Juges 12, 13, 14
        Jour 76 - Juges 15, 16, 17
        Jour 77 - Juges 18, 19, 20
        Jour 78 - Juges 21 ; Ruth 1, 2
        Jour 79 - Ruth 3, 4 ; 1 Samuel 1
        Jour 80 - 1 Samuel 2, 3, 4
        Jour 81 - 1 Samuel 5, 6, 7
        Jour 82 - 1 Samuel 8, 9, 10
        Jour 83 - 1 Samuel 11, 12, 13
        Jour 84 - 1 Samuel 14, 15, 16
        Jour 85 - 1 Samuel 17, 18, 19
        Jour 86 - 1 Samuel 20, 21, 22
        Jour 87 - 1 Samuel 23, 24, 25
        Jour 88 - 1 Samuel 26, 27, 28
        Jour 89 - 1 Samuel 29, 30, 31
        Jour 90 - 2 Samuel 1, 2, 3
        Jour 91 - 2 Samuel 4, 5, 6
        Jour 92 - 2 Samuel 7, 8, 9
        Jour 93 - 2 Samuel 10, 11, 12
        Jour 94 - 2 Samuel 13, 14, 15
        Jour 95 - 2 Samuel 16, 17, 18
        Jour 96 - 2 Samuel 19, 20, 21
        Jour 97 - 2 Samuel 22, 23, 24
        Jour 98 - 1 Rois 1, 2, 3
        Jour 99 - 1 Rois 4, 5, 6
        Jour 100 - 1 Rois 7, 8, 9
        Jour 101 - 1 Rois 10, 11, 12
        Jour 102 - 1 Rois 13, 14, 15
        Jour 103 - 1 Rois 16, 17, 18
        Jour 104 - 1 Rois 19, 20, 21
        Jour 105 - 1 Rois 22 ; 2 Rois 1, 2
        Jour 106 - 2 Rois 3, 4, 5
        Jour 107 - 2 Rois 6, 7, 8
        Jour 108 - 2 Rois 9, 10, 11
        Jour 109 - 2 Rois 12, 13, 14
        Jour 110 - 2 Rois 15, 16, 17
        Jour 111 - 2 Rois 18, 19, 20
        Jour 112 - 2 Rois 21, 22, 23
        Jour 113 - 2 Rois 24, 25 ; 1 Chroniques 1
        Jour 114 - 1 Chroniques 2, 3, 4
        Jour 115 - 1 Chroniques 5, 6, 7
        Jour 116 - 1 Chroniques 8, 9, 10
        Jour 117 - 1 Chroniques 11, 12, 13
        Jour 118 - 1 Chroniques 14, 15, 16
        Jour 119 - 1 Chroniques 17, 18, 19
        Jour 120 - 1 Chroniques 20, 21, 22
        Jour 121 - 1 Chroniques 23, 24, 25
        Jour 122 - 1 Chroniques 26, 27, 28
        Jour 123 - 1 Chroniques 29 ; 2 Chroniques 1
        Jour 124 - 2 Chroniques 2, 3, 4
        Jour 125 - 2 Chroniques 5, 6, 7
        Jour 126 - 2 Chroniques 8, 9, 10
        Jour 127 - 2 Chroniques 11, 12, 13
        Jour 128 - 2 Chroniques 14, 15, 16
        Jour 129 - 2 Chroniques 17, 18, 19
        Jour 130 - 2 Chroniques 20, 21, 22
        Jour 131 - 2 Chroniques 23, 24, 25
        Jour 132 - 2 Chroniques 26, 27, 28
        Jour 133 - 2 Chroniques 29, 30, 31
        Jour 134 - 2 Chroniques 32, 33, 34
        Jour 135 - 2 Chroniques 35, 36 ; Esdras 1
        Jour 136 - Esdras 2, 3, 4
        Jour 137 - Esdras 5, 6, 7
        Jour 138 - Esdras 8, 9, 10
        Jour 139 - Néhémie 1, 2, 3
        Jour 140 - Néhémie 4, 5, 6
        Jour 141 - Néhémie 7, 8, 9
        Jour 142 - Néhémie 10, 11, 12
        Jour 143 - Néhémie 13 ; Esther 1
        Jour 144 - Esther 2, 3, 4
        Jour 145 - Esther 5, 6, 7
        Jour 146 - Esther 8, 9, 10
        Jour 147 - Job 1, 2, 3
        Jour 148 - Job 4, 5, 6
        Jour 149 - Job 7, 8, 9
        Jour 150 - Job 10, 11, 12
        Jour 151 - Job 13, 14, 15
        Jour 152 - Job 16, 17, 18
        Jour 153 - Job 19, 20, 21
        Jour 154 - Job 22, 23, 24
        Jour 155 - Job 25, 26, 27
        Jour 156 - Job 28, 29, 30
        Jour 157 - Job 31, 32, 33
        Jour 158 - Job 34, 35, 36
        Jour 159 - Job 37, 38, 39
        Jour 160 - Job 40, 41, 42
        Jour 161 - Psaumes 1, 2, 3
        Jour 162 - Psaumes 4, 5, 6
        Jour 163 - Psaumes 7, 8, 9
        Jour 164 - Psaumes 10, 11, 12
        Jour 165 - Psaumes 13, 14, 15
        Jour 166 - Psaumes 16, 17, 18
        Jour 167 - Psaumes 19, 20, 21
        Jour 168 - Psaumes 22, 23, 24
        Jour 169 - Psaumes 25, 26, 27
        Jour 170 - Psaumes 28, 29, 30
        Jour 171 - Psaumes 31, 32, 33
        Jour 172 - Psaumes 34, 35, 36
        Jour 173 - Psaumes 37, 38, 39
        Jour 174 - Psaumes 40, 41, 42
        Jour 175 - Psaumes 43, 44, 45
        Jour 176 - Psaumes 46, 47, 48
        Jour 177 - Psaumes 49, 50, 51
        Jour 178 - Psaumes 52, 53, 54
        Jour 179 - Psaumes 55, 56, 57
        Jour 180 - Psaumes 58, 59, 60
        Jour 181 - Psaumes 61, 62, 63
        Jour 182 - Psaumes 64, 65, 66
        Jour 183 - Psaumes 67, 68, 69
        Jour 184 - Psaumes 70, 71, 72
        Jour 185 - Psaumes 73, 74, 75
        Jour 186 - Psaumes 76, 77, 78
        Jour 187 - Psaumes 79, 80, 81
        Jour 188 - Psaumes 82, 83, 84
        Jour 189 - Psaumes 85, 86, 87
        Jour 190 - Psaumes 88, 89, 90
        Jour 191 - Psaumes 91, 92, 93
        Jour 192 - Psaumes 94, 95, 96
        Jour 193 - Psaumes 97, 98, 99
        Jour 194 - Psaumes 100, 101, 102
        Jour 195 - Psaumes 103, 104, 105
        Jour 196 - Psaumes 106, 107, 108
        Jour 197 - Psaumes 109, 110, 111
        Jour 198 - Psaumes 112, 113, 114
        Jour 199 - Psaumes 115, 116, 117
        Jour 200 - Psaumes 118, 119, 120
        Jour 201 - Psaumes 121, 122, 123
        Jour 202 - Psaumes 124, 125, 126
        Jour 203 - Psaumes 127, 128, 129
        Jour 204 - Psaumes 130, 131, 132
        Jour 205 - Psaumes 133, 134, 135
        Jour 206 - Psaumes 136, 137, 138
        Jour 207 - Psaumes 139, 140, 141
        Jour 208 - Psaumes 142, 143, 144
        Jour 209 - Psaumes 145, 146, 147
        Jour 210 - Psaumes 148, 149, 150
        Jour 211 - Proverbes 1, 2, 3
        Jour 212 - Proverbes 4, 5, 6
        Jour 213 - Proverbes 7, 8, 9
        Jour 214 - Proverbes 10, 11, 12
        Jour 215 - Proverbes 13, 14, 15
        Jour 216 - Proverbes 16, 17, 18
        Jour 217 - Proverbes 19, 20, 21
        Jour 218 - Proverbes 22, 23, 24
        Jour 219 - Proverbes 25, 26, 27
        Jour 220 - Proverbes 28, 29, 30
        Jour 221 - Proverbes 31 ; Ecclésiaste 1
        Jour 222 - Ecclésiaste 2, 3, 4
        Jour 223 - Ecclésiaste 5, 6, 7
        Jour 224 - Ecclésiaste 8, 9, 10
        Jour 225 - Ecclésiaste 11, 12 ; Cantique des Cantiques 1
        Jour 226 - Cantique des Cantiques 2, 3, 4
        Jour 227 - Cantique des Cantiques 5, 6, 7
        Jour 228 - Cantique des Cantiques 8 ; Isaïe 1
        Jour 229 - Isaïe 2, 3, 4
        Jour 230 - Isaïe 5, 6, 7
        Jour 231 - Isaïe 8, 9, 10
        Jour 232 - Isaïe 11, 12, 13
        Jour 233 - Isaïe 14, 15, 16
        Jour 234 - Isaïe 17, 18, 19
        Jour 235 - Isaïe 20, 21, 22
        Jour 236 - Isaïe 23, 24, 25
        Jour 237 - Isaïe 26, 27, 28
        Jour 238 - Isaïe 29, 30, 31
        Jour 239 - Isaïe 32, 33, 34
        Jour 240 - Isaïe 35, 36, 37
        Jour 241 - Isaïe 38, 39, 40
        Jour 242 - Isaïe 41, 42, 43
        Jour 243 - Isaïe 44, 45, 46
        Jour 244 - Isaïe 47, 48, 49
        Jour 245 - Isaïe 50, 51, 52
        Jour 246 - Isaïe 53, 54, 55
        Jour 247 - Isaïe 56, 57, 58
        Jour 248 - Isaïe 59, 60, 61
        Jour 249 - Isaïe 62, 63, 64
        Jour 250 - Isaïe 65, 66 ; Jérémie 1
        Jour 251 - Jérémie 2, 3, 4
        Jour 252 - Jérémie 5, 6, 7
        Jour 253 - Jérémie 8, 9, 10
        Jour 254 - Jérémie 11, 12, 13
        Jour 255 - Jérémie 14, 15, 16
        Jour 256 - Jérémie 17, 18, 19
        Jour 257 - Jérémie 20, 21, 22
        Jour 258 - Jérémie 23, 24, 25
        Jour 259 - Jérémie 26, 27, 28
        Jour 260 - Jérémie 29, 30, 31
        Jour 261 - Jérémie 32, 33, 34
        Jour 262 - Jérémie 35, 36, 37
        Jour 263 - Jérémie 38, 39, 40
        Jour 264 - Jérémie 41, 42, 43
        Jour 265 - Jérémie 44, 45, 46
        Jour 266 - Jérémie 47, 48, 49
        Jour 267 - Jérémie 50, 51, 52
        Jour 268 - Lamentations 1, 2, 3
        Jour 269 - Lamentations 4, 5 ; Ézéchiel 1
        Jour 270 - Ézéchiel 2, 3, 4
        Jour 271 - Ézéchiel 5, 6, 7
        Jour 272 - Ézéchiel 8, 9, 10
        Jour 273 - Ézéchiel 11, 12, 13
        Jour 274 - Ézéchiel 14, 15, 16
        Jour 275 - Ézéchiel 17, 18, 19
        Jour 276 - Ézéchiel 20, 21, 22
        Jour 277 - Ézéchiel 23, 24, 25
        Jour 278 - Ézéchiel 26, 27, 28
        Jour 279 - Ézéchiel 29, 30, 31
        Jour 280 - Ézéchiel 32, 33, 34
        Jour 281 - Ézéchiel 35, 36, 37
        Jour 282 - Ézéchiel 38, 39, 40
        Jour 283 - Ézéchiel 41, 42, 43
        Jour 284 - Ézéchiel 44, 45, 46
        Jour 285 - Ézéchiel 47, 48 ; Daniel 1
        Jour 286 - Daniel 2, 3, 4
        Jour 287 - Daniel 5, 6, 7
        Jour 288 - Daniel 8, 9, 10
        Jour 289 - Daniel 11, 12 ; Osée 1
        Jour 290 - Osée 2, 3, 4
        Jour 291 - Osée 5, 6, 7
        Jour 292 - Osée 8, 9, 10
        Jour 293 - Osée 11, 12, 13
        Jour 294 - Osée 14 ; Joël 1, 2
        Jour 295 - Joël 3 ; Amos 1, 2
        Jour 296 - Amos 3, 4, 5
        Jour 297 - Amos 6, 7, 8
        Jour 298 - Amos 9 ; Abdias 1 ; Jonas 1
        Jour 299 - Jonas 2, 3, 4 ; Michée 1
        Jour 300 - Michée 2, 3, 4
        Jour 301 - Michée 5, 6, 7
        Jour 302 - Nahum 1, 2, 3 ; Habacuc 1
        Jour 303 - Habacuc 2, 3 ; Sophonie 1
        Jour 304 - Sophonie 2, 3 ; Aggée 1
        Jour 305 - Aggée 2 ; Zacharie 1, 2
        Jour 306 - Zacharie 3, 4, 5
        Jour 307 - Zacharie 6, 7, 8
        Jour 308 - Zacharie 9, 10, 11
        Jour 309 - Zacharie 12, 13, 14
        Jour 310 - Malachie 1, 2, 3
        Jour 311 - Malachie 4 ; Matthieu 1, 2
        Jour 312 - Matthieu 3, 4, 5
        Jour 313 - Matthieu 6, 7, 8
        Jour 314 - Matthieu 9, 10, 11
        Jour 315 - Matthieu 12, 13, 14
        Jour 316 - Matthieu 15, 16, 17
        Jour 317 - Matthieu 18, 19, 20
        Jour 318 - Matthieu 21, 22, 23
        Jour 319 - Matthieu 24, 25, 26
        Jour 320 - Matthieu 27, 28 ; Marc 1
        Jour 321 - Marc 2, 3, 4
        Jour 322 - Marc 5, 6, 7
        Jour 323 - Marc 8, 9, 10
        Jour 324 - Marc 11, 12, 13
        Jour 325 - Marc 14, 15, 16
        Jour 326 - Luc 1, 2, 3
        Jour 327 - Luc 4, 5, 6
        Jour 328 - Luc 7, 8, 9
        Jour 329 - Luc 10, 11, 12
        Jour 330 - Luc 13, 14, 15
        Jour 331 - Luc 16, 17, 18
        Jour 332 - Luc 19, 20, 21
        Jour 333 - Luc 22, 23, 24
        Jour 334 - Jean 1, 2, 3
        Jour 335 - Jean 4, 5, 6
        Jour 336 - Jean 7, 8, 9
        Jour 337 - Jean 10, 11, 12
        Jour 338 - Jean 13, 14, 15
        Jour 339 - Jean 16, 17, 18
        Jour 340 - Jean 19, 20, 21
        Jour 341 - Actes 1, 2, 3
        Jour 342 - Actes 4, 5, 6
        Jour 343 - Actes 7, 8, 9
        Jour 344 - Actes 10, 11, 12
        Jour 345 - Actes 13, 14, 15
        Jour 346 - Actes 16, 17, 18
        Jour 347 - Actes 19, 20, 21
        Jour 348 - Actes 22, 23, 24
        Jour 349 - Actes 25, 26, 27
        Jour 350 - Actes 28 ; Romains 1
        Jour 351 - Romains 2, 3, 4
        Jour 352 - Romains 5, 6, 7
        Jour 353 - Romains 8, 9, 10
        Jour 354 - Romains 11, 12, 13
        Jour 355 - Romains 14, 15, 16
        Jour 356 - 1 Corinthiens 1, 2, 3
        Jour 357 - 1 Corinthiens 4, 5, 6
        Jour 358 - 1 Corinthiens 7, 8, 9
        Jour 359 - 1 Corinthiens 10, 11, 12
        Jour 360 - 1 Corinthiens 13, 14, 15
        Jour 361 - 1 Corinthiens 16 ; 2 Corinthiens 1, 2
        Jour 362 - 2 Corinthiens 3, 4, 5
        Jour 363 - 2 Corinthiens 6, 7, 8
        Jour 364 - 2 Corinthiens 9, 10, 11
        Jour 365 - 2 Corinthiens 12, 13 ; Galates 1, 2
        `;

        // Références aux éléments du DOM pour le plan biblique
        const biblePlanSection = document.getElementById('bible-plan-section');
        const currentDayText = document.getElementById('current-day-text');
        const currentReadingText = document.getElementById('current-reading-text');
        const prevDayBtn = document.getElementById('prev-day-btn');
        const nextDayBtn = document.getElementById('next-day-btn');
        const openReadingBtn = document.getElementById('open-reading-btn');
        const prevDateSpan = document.getElementById('prev-date');
        const nextDateSpan = document.getElementById('next-date');

        // Références aux éléments du DOM pour la section Neuvaines
        const novenasStandaloneSection = document.getElementById('novenas-standalone-section');
        const novenaSelect = document.getElementById('novena-select');
        const novenaStartDateInput = document.getElementById('novena-start-date');
        const prevNovenaDayBtn = document.getElementById('prev-novena-day-btn');
        const nextNovenaDayBtn = document.getElementById('next-novena-day-btn');
        const novenaMainTitle = document.getElementById('novena-main-title');
        const novenaPhoto = document.getElementById('neuvaine-photo');
        const photoUpload = document.getElementById('photoUpload');
        const bougie = document.getElementById('bougie');
        const demandeDuJourTextarea = document.getElementById('demandeDuJour');
        const saveDemandeBtn = document.getElementById('saveDemande');
        const initialPrayersContainer = document.getElementById('initial-prayers');
        const dailyPrayerTitle = document.getElementById('daily-prayer-title');
        const dailyPrayerText = document.getElementById('daily-prayer-text');

        // Boîte de message temporaire
        const messageBox = document.getElementById('message-box');

        // Variables d'état de l'application
        let readingPlan = [];
        let currentDayIndex = 0; // Index du jour dans le plan de lecture (0-indexé)
        let userNovenasState = {}; // Stocke les dates de début pour chaque neuvaine
        let selectedNovenaId = ""; // ID de la neuvaine actuellement sélectionnée
        let displayedNovenaDay = 0; // Le jour actuellement affiché dans la section neuvaine (1-9)

        // ====================================================================================
        // FONCTIONS UTILITAIRES
        // ====================================================================================
        
        /**
         * Affiche un message temporaire à l'écran.
         * @param {string} message - Le texte du message à afficher.
         * @param {number} duration - La durée d'affichage du message en millisecondes (par défaut 3000ms).
         */
        function showMessage(message, duration = 3000) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'opacity-0');
            messageBox.classList.add('opacity-100');
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 300); // Laisse le temps à la transition de s'exécuter
            }, duration);
        }

        /**
         * Analyse le texte brut du plan de lecture et le convertit en un tableau d'objets.
         * @param {string} rawText - Le texte brut du plan de lecture.
         * @returns {Array<Object>} Un tableau d'objets { day: number, reading: string, bibleGatewayUrl: string }.
         */
        function parseReadingPlan(rawText) {
            const lines = rawText.split('\n');
            const parsedPlan = [];
            lines.forEach(line => {
                const trimmedLine = line.trim();
                const match = trimmedLine.match(/Jour (\d+) - (.+)/);
                if (match) {
                    const dayNum = parseInt(match[1], 10);
                    const reading = match[2];
                    const encodedReading = encodeURIComponent(reading.replace(/,/g, '; '));
                    const bibleGatewayUrl = `https://www.biblegateway.com/passage/?search=${encodedReading}&version=NEG1979`;
                    parsedPlan.push({
                        day: dayNum,
                        reading: reading,
                        bibleGatewayUrl: bibleGatewayUrl
                    });
                }
            });
            return parsedPlan;
        }

        /**
         * Calcule le jour de l'année actuel (1 pour le 1er janvier, etc.).
         * @returns {number} Le numéro du jour dans l'année.
         */
        function getDayOfYear() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        /**
         * Obtient la date réelle pour un décalage de jour donné par rapport au jour actuel de l'année.
         * @param {number} dayOffset - Le décalage en jours.
         * @returns {string} La date formatée (ex: "01 Jan").
         */
        function getRealDate(dayOffset) {
            const today = new Date();
            const targetDate = new Date(today);
            targetDate.setDate(today.getDate() + dayOffset);
            const options = { day: '2-digit', month: 'short' };
            return targetDate.toLocaleDateString('fr-FR', options);
        }

        /**
         * Sauvegarde l'état des neuvaines (dates de début, photos, bougie) dans le stockage local.
         */
        function saveNovenasState() {
            localStorage.setItem('userNovenasState', JSON.stringify(userNovenasState));
            localStorage.setItem('neuvainePhoto', novenaPhoto.src);
            localStorage.setItem('bougieLit', bougie.classList.contains('bougie-lit'));
            localStorage.setItem('demandeDuJourTextarea', demandeDuJourTextarea.value);
        }

        /**
         * Charge l'état des neuvaines depuis le stockage local.
         */
        function loadNovenasState() {
            const savedState = localStorage.getItem('userNovenasState');
            if (savedState) {
                userNovenasState = JSON.parse(savedState);
            }
            const savedPhoto = localStorage.getItem('neuvainePhoto');
            if (savedPhoto) {
                novenaPhoto.src = savedPhoto;
            }
            const savedBougie = localStorage.getItem('bougieLit');
            if (savedBougie === 'true') {
                bougie.src = "https://storage.googleapis.com/gweb-uniblog-publish-prod/images/candle-lit.png";
                bougie.classList.add('bougie-lit');
            }
            const savedDemande = localStorage.getItem('demandeDuJourTextarea');
            if (savedDemande) {
                demandeDuJourTextarea.value = savedDemande;
            }
        }
        
        /**
         * Calcule le jour actuel d'une neuvaine en fonction de sa date de début.
         * @param {string} startDateString - La date de début de la neuvaine au format YYYY-MM-DD.
         * @returns {number} Le jour de la neuvaine (1-9), ou 0 si non en cours.
         */
        function calculateNovenaDay(startDateString) {
            if (!startDateString) return 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const startDate = new Date(startDateString);
            const diffInDays = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            // Le jour 0 est le premier jour, donc on ajoute 1 pour obtenir le jour de la neuvaine
            const day = diffInDays + 1;
            return (day > 0 && day <= 9) ? day : 0;
        }

        /**
         * Met à jour l'affichage de la neuvaine avec la prière du jour sélectionné.
         * @param {string} novenaId - L'ID de la neuvaine.
         * @param {number} dayNumber - Le jour de la neuvaine (1-9).
         */
        function updateNovenaDisplay(novenaId, dayNumber) {
            const novena = novenasDefinitions.find(n => n.id === novenaId);
            if (!novena) {
                dailyPrayerTitle.textContent = "Aucune neuvaine sélectionnée";
                dailyPrayerText.textContent = "Veuillez choisir une neuvaine.";
                return;
            }
            const day = novena.days.find(d => d.day === dayNumber);
            if (day) {
                novenaMainTitle.textContent = `${novena.name} - Jour ${dayNumber}`;
                dailyPrayerTitle.textContent = day.title;
                dailyPrayerText.textContent = day.text;
                displayedNovenaDay = dayNumber;
            } else {
                novenaMainTitle.textContent = novena.name;
                dailyPrayerTitle.textContent = "Fin de la Neuvaine";
                dailyPrayerText.textContent = "La neuvaine est terminée ou non commencée.";
                displayedNovenaDay = 0;
            }
            updateNovenaNavigationButtons();
        }

        /**
         * Met à jour les boutons de navigation de la neuvaine (précédent/suivant).
         */
        function updateNovenaNavigationButtons() {
            if (!selectedNovenaId) {
                prevNovenaDayBtn.disabled = true;
                nextNovenaDayBtn.disabled = true;
                return;
            }
            prevNovenaDayBtn.disabled = displayedNovenaDay <= 1;
            nextNovenaDayBtn.disabled = displayedNovenaDay >= 9;
        }

        /**
         * Gère le changement de sélection de la neuvaine.
         */
        function handleNovenaSelection() {
            selectedNovenaId = novenaSelect.value;
            const startDateString = userNovenasState[selectedNovenaId];
            if (startDateString) {
                novenaStartDateInput.value = startDateString;
                novenaStartDateInput.disabled = false;
            } else {
                novenaStartDateInput.value = '';
                novenaStartDateInput.disabled = false;
            }
            const calculatedDay = calculateNovenaDay(novenaStartDateInput.value);
            if (calculatedDay > 0) {
                updateNovenaDisplay(selectedNovenaId, calculatedDay);
            } else {
                updateNovenaDisplay(selectedNovenaId, 1);
            }
        }
        
        // ====================================================================================
        // LOGIQUE ET ÉVÉNEMENTS
        // ====================================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            // -- Initialisation du Plan de Lecture --
            readingPlan = parseReadingPlan(rawBibleReadingPlan);
            currentDayIndex = getDayOfYear() - 1; // Jour de l'année est 1-indexé, le tableau est 0-indexé
            updateBiblePlanDisplay();
            
            // -- Événements du Plan de Lecture --
            prevDayBtn.addEventListener('click', () => {
                currentDayIndex--;
                updateBiblePlanDisplay();
            });

            nextDayBtn.addEventListener('click', () => {
                currentDayIndex++;
                updateBiblePlanDisplay();
            });

            function updateBiblePlanDisplay() {
                if (readingPlan.length === 0) {
                    currentDayText.textContent = "Aucun plan de lecture disponible.";
                    currentReadingText.textContent = "";
                    prevDayBtn.disabled = true;
                    nextDayBtn.disabled = true;
                    openReadingBtn.disabled = true;
                    prevDateSpan.textContent = "";
                    nextDateSpan.textContent = "";
                    return;
                }
                if (currentDayIndex < 0) currentDayIndex = 0;
                if (currentDayIndex >= readingPlan.length) currentDayIndex = readingPlan.length - 1;

                const currentEntry = readingPlan[currentDayIndex];
                currentDayText.textContent = `Jour ${currentEntry.day}`;
                currentReadingText.textContent = currentEntry.reading;
                
                prevDayBtn.disabled = currentDayIndex === 0;
                nextDayBtn.disabled = currentDayIndex === readingPlan.length - 1;
                openReadingBtn.disabled = false;

                if (currentDayIndex > 0) {
                    prevDateSpan.textContent = `(${getRealDate(currentDayIndex - (getDayOfYear() - 1))})`;
                } else {
                    prevDateSpan.textContent = "";
                }

                if (currentDayIndex < readingPlan.length - 1) {
                    nextDateSpan.textContent = `(${getRealDate(currentDayIndex + 1 - (getDayOfYear() - 1))})`;
                } else {
                    nextDateSpan.textContent = "";
                }

                openReadingBtn.onclick = () => {
                    window.open(currentEntry.bibleGatewayUrl, '_blank');
                };
            }

            // -- Initialisation de la section Neuvaines --
            loadNovenasState();
            
            novenasDefinitions.forEach(novena => {
                const option = document.createElement('option');
                option.value = novena.id;
                option.textContent = novena.name;
                novenaSelect.appendChild(option);
            });
            novenaSelect.value = Object.keys(userNovenasState)[0] || novenasDefinitions[0].id;
            handleNovenaSelection();
            
            // -- Événements de la section Neuvaines --
            novenaSelect.addEventListener('change', handleNovenaSelection);

            novenaStartDateInput.addEventListener('change', () => {
                const newDate = novenaStartDateInput.value;
                userNovenasState[selectedNovenaId] = newDate;
                saveNovenasState();
                const calculatedDay = calculateNovenaDay(newDate);
                if (calculatedDay > 0) {
                    updateNovenaDisplay(selectedNovenaId, calculatedDay);
                } else {
                    updateNovenaDisplay(selectedNovenaId, 1);
                }
            });

            prevNovenaDayBtn.addEventListener('click', () => {
                if (displayedNovenaDay > 1) {
                    updateNovenaDisplay(selectedNovenaId, displayedNovenaDay - 1);
                }
            });

            nextNovenaDayBtn.addEventListener('click', () => {
                if (displayedNovenaDay < 9) {
                    updateNovenaDisplay(selectedNovenaId, displayedNovenaDay + 1);
                }
            });

            photoUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        novenaPhoto.src = e.target.result;
                        saveNovenasState(); // Sauvegarder la photo
                    };
                    reader.readAsDataURL(file);
                }
            });

            bougie.addEventListener('click', () => {
                if (bougie.classList.contains('bougie-lit')) {
                    bougie.src = "https://storage.googleapis.com/gweb-uniblog-publish-prod/images/candle-unlit.png";
                    bougie.classList.remove('bougie-lit');
                } else {
                    bougie.src = "https://storage.googleapis.com/gweb-uniblog-publish-prod/images/candle-lit.png";
                    bougie.classList.add('bougie-lit');
                }
                saveNovenasState();
            });

            saveDemandeBtn.addEventListener('click', () => {
                saveNovenasState();
                showMessage("Votre demande a été sauvegardée !");
            });

        });
    </script>
</body>
</html>
